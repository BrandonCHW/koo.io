<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- <script type="text/javascript" src="listeners.js"></script> -->
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <title>Koo.io</title>
        <!-- jQuery JS (required for Bootstrap)-->
        <script src="../node_modules/jquery/dist/jquery.slim.min.js"></script>
        <script src="../node_modules/popper.js/dist/umd/popper.min.js"></script>
        <!-- Bootstrap CSS -->
        <!-- <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css"> -->
        <link rel="stylesheet" href="custom_bootstrap.css">
        <link rel="stylesheet" href="main.css">
    </head>
    <body style="height: 100vh;" class="bg-primary">
        <!-- Login Page -->
        <div class="container h-100">
            <div class="row h-25 align-items-end justify-content-center">
                <h1>Koo.io</h1>
            </div>
            <div class="row h-50 align-items-center justify-content-center">
                <div class="bg-secondary p-5 rounded">
                    <div class="row my-3">
                        <div class="col form-group">
                            <input class="form-control" placeholder="Player">
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col">
                            <button type="button" class="btn btn-primary h-100">
                                Find Lobby
                            </button>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-primary h-100">
                                Join Lobby
                            </button>
                        </div>
                    </div>
                    <div class="row my-3 justify-content-center">
                        <div class="col">
                            <button type="button" class="btn btn-primary w-100">
                                How to play
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row h-25 align-items-end justify-content-center">
                <div class="bg-secondary rounded p-2 mb-1 text-dark">
                    Credits: Bred and Chimp, inspired by Rikki Rahta's original Coup with the secret 11 herbs and spices.
                </div>
            </div>
          </div>
        <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

        <div>
            <p>Timer: <span id="roundTimer"></span></p>
        </div>
        <!-- Other players data -->
        <div>
            <h1>Other Players</h1>
            <p>cartemere Card 1:<span id="temp1Card1">?</span> Card 2:<span id="temp1Card2">?</span> Coins:<span id="temp1Coins">0</span> </p>
            <p>ChimpUnleashed Card1:<span id="temp2Card1">?</span> Card 2:<span id="temp2Card2">?</span> Coins:<span id="temp2Coins">0</span> </p>
        </div>
    
        <!-- Current player data -->
        <div>
            <h1>Player status</h1>
            <p>Player Coins: <span id="pCoins">0</span></p>
            <p>Card 1: <span id="pCard1Name">card1</span>; Status: <span id="pCard1Status">Alive</span></p>
            <p>Card 2: <span id="pCard2Name">card2</span>; Status: <span id="pCard2Status">Alive</span></p>
            
        </div>
            
        <!-- Player actions -->
        <div id="actions">
            <h4>Generic</h4>
            <div>
                <button id="income">Income: +1 Coin</button>
                <button id="foreign">Foreign: +2 Coin</button>
                <button id="coup">Coup: -7 Coins</button>
            </div>
            <h4>Special Action</h4>
            <div>
                <button id="tax">Tax: +3 Coins</button>
                <button id="steal">Steal: Yoink (+2 coins)</button>
                <button id="assassinate">Assassinate: Kill (-3 Coins)</button>
                <button id="exchange">Exchange: Take 2 cards, keep 1</button>
            </div>
    
            <div id="playerSelector" style="display: none;">
                <h4>Intention: <span id="intention">lemheurdheur</span></h4>
                <button onclick="selectPlayer(this)">cartemere</button>
                <button onclick="selectPlayer(this)">ChimpUnleashed</button>
            </div>
    
        </div>
    
        <!-- Card Select (Exchange) -->
        <div>
            <button id="tax">Tax: +3 Coins</button>
            <button id="steal">Steal: Yoink (+2 coins)</button>
            <button id="assassinate">Assassinate: Kill (-3 Coins)</button>
            <button id="exchange">Exchange: Take 2 cards, keep 1</button>
        </div>

        <div id="playerSelector" style="display: none;">
            <h4>Intention: <span id="intention">lemheurdheur</span></h4>
            <button onclick="selectPlayer(this)">cartemere</button>
            <button onclick="selectPlayer(this)">ChimpUnleashed</button>
        </div>

    </div>

    <!-- Card Select (Exchange) -->
    <div>

    </div>    

    <script>
        // var a = $("div[id='actions'] div button").on("click", function(btn) {
        //     console.log(btn.target.id)
        // })

        // Receive new game state updates
        var socket = io()
        socket.on('state change', (p) => {
            // updateSelfView(p)
        })

        // called when the player bitconnects to the lobby
        socket.on('self connection', (initialState) => {
            updateSelfView(initialState)
        })

        // Receive timer update (regularly updated)
        socket.on('timer', (time) => {
            updateTimer(time)
        })

        function updateSelfView(p) {
            $("#pCoins").text(p.coins)
            $("#pCard1Name").text(p.firstCard)
            $("#pCard1Status").text(p.firstCardStatus)
            $("#pCard2Name").text(p.secondCard)
            $("#pCard1Status").text(p.secondCardStatus)
        }

        function updateTimer(time) {
            var timer = document.getElementById("roundTimer").textContent = time
        }

        class ActionPayload { 
            constructor(intent, to="") {
                this.id = socket.id
                this.intent = intent
                this.to = to
            }
        }

        var income = $("#income").on("click", function() {
            socket.emit('action', new ActionPayload("income"))
        })
        var foreign = $("#foreign").on("click", function() {
            socket.emit('action', new ActionPayload("foreign"))
        })
        var coup = $("#coup").on("click", function() {
            socket.emit('action', new ActionPayload("coup"))
        })
        var tax = $("#tax").on("click", function() {
            socket.emit('action', new ActionPayload("tax"))
        })
        var steal = $("#steal").on("click", function() {
            changeCoins(2)
            declareIntention("steal")
        })
        var assassinate = $("#assassinate").on("click", function() {
            declareIntention("assassinate")
        })
        var exchange = $("#exchange").on("click", function() {
        })

        //Declares the intention (String)
        function declareIntention(intention) {
            $("#playerSelector").css("display","block")
            $("#intention").text(intention)
        }

        //choose a player (steal, assassinate)
        function selectPlayer(identifier) {
            console.log("selected player", $(identifier).text());
            $("#playerSelector").css("display","none")

            socket.emit('action', 
                new ActionPayload("player", $("#intention").text(), $(identifier).text()))
        }

    </script>
</body>
</html>